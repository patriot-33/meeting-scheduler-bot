# Диагностические инструменты, созданные для анализа проблем

## 1. diagnostic_system_v4.py
**Назначение**: Комплексная диагностическая система с обязательным сохранением истории

### Ключевые компоненты:
- `MandatoryHistoryPersistence` - сохранение всех изменений в SQLite
- `SystemAnalyzer` - анализ общего состояния системы
- `MeetingDuplicationAnalyzer` - анализ дублирования встреч
- `GoogleMeetAnalyzer` - анализ проблем с Google Meet
- `CalendarConnectionAnalyzer` - анализ подключения календарей

### Функции:
- Автоматическое создание бэкапов перед изменениями
- Сохранение истории всех диагностических операций
- Генерация отчетов в JSON формате
- Безопасное применение исправлений с возможностью отката

## 2. emergency_rollback_and_diagnosis.py
**Назначение**: Экстренный откат при ухудшении ситуации

### Возможности:
- Немедленный откат к предыдущему состоянию
- Оценка ущерба (damage assessment)
- Сохранение состояния до и после отката
- Генерация экстренного протокола

## 3. root_cause_analyzer.py
**Назначение**: Глубокий анализ корневых причин дублирования

### Анализирует:
- Точки входа создания встреч
- Все вызовы `create_meeting_in_both_calendars`
- Вызовы `events().insert` в Google Calendar API
- Потенциальные циклы и дублирования

### Результат:
- Файл `ROOT_CAUSE_ANALYSIS_REPORT.json`
- Выявлена проблема: 2×2×2 = 8 потенциальных событий

## 4. precise_fix_implementation.py
**Назначение**: Точное применение исправлений с верификацией

### Функции:
- Создание бэкапов перед каждым изменением
- Применение конкретных исправлений
- Автоматическая верификация результатов
- Подсчет ожидаемого количества событий

### Исправления:
1. Удаление дублированного fallback блока
2. Упрощение `_create_event_with_fallback` до 1 вызова
3. Сохранение результатов в `PRECISE_FIX_RESULTS.json`

## 5. analyze_owner_calendar_issue.py
**Назначение**: Анализ проблем с календарем владельца

### Проверяет:
- Наличие владельцев с подключенными календарями
- Валидность email адресов
- OAuth credentials владельцев
- Историю создания встреч

## Использование инструментов

### Для диагностики:
```bash
python diagnostic_system_v4.py
```

### Для экстренного отката:
```bash
python emergency_rollback_and_diagnosis.py
```

### Для анализа корневых причин:
```bash
python root_cause_analyzer.py
```

### Для применения исправлений:
```bash
python precise_fix_implementation.py
```

## Сгенерированные отчеты

1. **DIAGNOSTIC_REPORT_*.json** - полные диагностические отчеты
2. **ROOT_CAUSE_ANALYSIS_REPORT.json** - анализ корневых причин
3. **PRECISE_FIX_RESULTS.json** - результаты применения исправлений
4. **EMERGENCY_DAMAGE_REPORT.json** - оценка ущерба при откате
5. **EMERGENCY_PROTOCOL_RESULTS.json** - протокол экстренных действий

## Рекомендации по использованию

1. **При новых проблемах**: начинать с `diagnostic_system_v4.py`
2. **При ухудшении**: использовать `emergency_rollback_and_diagnosis.py`
3. **Для глубокого анализа**: `root_cause_analyzer.py`
4. **Для исправлений**: `precise_fix_implementation.py` с обязательной верификацией