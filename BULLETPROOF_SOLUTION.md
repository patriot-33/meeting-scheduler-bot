# üõ°Ô∏è BULLETPROOF –†–ï–®–ï–ù–ò–ï –î–õ–Ø –í–õ–ê–î–ï–õ–¨–¶–ï–í

## üìã –ü–†–û–ë–õ–ï–ú–ê
–°–∏—Å—Ç–µ–º–∞ –∂–µ—Å—Ç–∫–æ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ —Ä–æ–≤–Ω–æ 2 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ 1 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –≤–º–µ—Å—Ç–æ 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö.
```

## ‚úÖ –†–ï–®–ï–ù–ò–ï (BULLETPROOF)

### 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–û–ù–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.py`:

```python
# Owner management - BULLETPROOF configuration
expected_owners_count: int = Field(
    default=1,  # ‚Üê –£–°–¢–ê–ù–û–í–õ–ï–ù–û 1 –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    env="EXPECTED_OWNERS_COUNT",
    description="Expected number of owners (1 for single-owner mode, 2+ for multi-owner mode)"
)
allow_single_owner_mode: bool = Field(
    default=True,  # ‚Üê –†–ê–ó–†–ï–®–ï–ù single-owner —Ä–µ–∂–∏–º
    env="ALLOW_SINGLE_OWNER_MODE", 
    description="Allow system to work with only 1 owner (bulletproof mode)"
)
```

### 2. –õ–û–ì–ò–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò –í–õ–ê–î–ï–õ–¨–¶–ï–í

#### `get_available_slots_for_both_owners()` - BULLETPROOF —Ä–µ–∂–∏–º:
- ‚úÖ **0 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
- ‚úÖ **1 –≤–ª–∞–¥–µ–ª–µ—Ü**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤ single-owner —Ä–µ–∂–∏–º  
- ‚úÖ **2+ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ–º —Å–ª–æ—Ç–æ–≤ –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö

#### `are_both_owners_available()` - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞:
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- ‚úÖ Graceful fallback –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### 3. –ó–ê–©–ò–¢–ê –û–¢ –†–ï–ì–†–ï–°–°–ò–ô

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```python
# Owner configuration validation (BULLETPROOF)
admin_count = len(settings.admin_ids_list)
expected_count = settings.expected_owners_count

if admin_count < expected_count:
    if not settings.allow_single_owner_mode and admin_count == 1:
        errors.append("Expected 2 owners but found 1, and single owner mode is disabled")
    else:
        print("‚ö†Ô∏è Warning: Running in single-owner bulletproof mode.")
```

#### Edge Cases –ø–æ–∫—Ä—ã—Ç—ã:
- üõ°Ô∏è **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤**: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- üõ°Ô∏è **Google Calendar –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: Fallback —Ä–µ–∂–∏–º
- üõ°Ô∏è **–û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–π single-mode**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –æ—Ç–∫–∞–∑
- üõ°Ô∏è **–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏–π**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Å –∞–≤—Ç–æ–∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π

### 4. –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø 1 –í–õ–ê–î–ï–õ–¨–¶–ê

```python
def _get_single_owner_slots(owner: User, days_ahead: int) -> Dict[str, List[str]]:
    """Get available slots for a single owner (bulletproof mode for 1 owner)."""
    # –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞:
    # - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
    # - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
    # - –ü—Ä–æ–≤–µ—Ä–∫–∞ Google Calendar (optional)
    # - –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
```

## üöÄ –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–û (–ø—Ä–æ–±–ª–µ–º–∞):
```
2025-07-30 18:51:15,203 - services.owner_service - WARNING - ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ 1 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –≤–º–µ—Å—Ç–æ 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö.
```

### –ü–û–°–õ–ï (bulletproof):
```
2025-07-30 19:00:00,000 - services.owner_service - INFO - ‚ÑπÔ∏è BULLETPROOF —Ä–µ–∂–∏–º: 1 –≤–ª–∞–¥–µ–ª–µ—Ü –∏–∑ 1 –æ–∂–∏–¥–∞–µ–º—ã—Ö - John
2025-07-30 19:00:00,001 - services.owner_service - INFO - ‚úÖ –ù–∞–π–¥–µ–Ω–æ 5 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è single-owner —Ä–µ–∂–∏–º–∞
```

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (1 –≤–ª–∞–¥–µ–ª–µ—Ü):
```bash
export EXPECTED_OWNERS_COUNT=1
export ALLOW_SINGLE_OWNER_MODE=true
export ADMIN_TELEGRAM_IDS="123456789"  # 1 ID
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (2 –≤–ª–∞–¥–µ–ª—å—Ü–∞):
```bash  
export EXPECTED_OWNERS_COUNT=2
export ALLOW_SINGLE_OWNER_MODE=true  # Fallback —Ä–∞–∑—Ä–µ—à–µ–Ω
export ADMIN_TELEGRAM_IDS="123456789,987654321"  # 2 ID
```

### –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ 2):
```bash
export EXPECTED_OWNERS_COUNT=2
export ALLOW_SINGLE_OWNER_MODE=false  # Fallback –∑–∞–ø—Ä–µ—â–µ–Ω
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### Bulletproof –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **Fail-Safe**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
2. **Configurable**: –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **Backward Compatible**: –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è 2 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞
4. **Defensive**: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
5. **Observable**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- ‚úÖ 1 –≤–ª–∞–¥–µ–ª–µ—Ü: Single-owner —Ä–µ–∂–∏–º
- ‚úÖ 2 –≤–ª–∞–¥–µ–ª—å—Ü–∞: Intersection —Ä–µ–∂–∏–º (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- ‚úÖ 3+ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤: Intersection –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- ‚úÖ –ë—É–¥—É—â–µ–µ: –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ N –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

## üéØ –ò–¢–û–ì
–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ 1 –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –≤–º–µ—Å—Ç–æ 2" –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è.
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ BULLETPROOF —Ä–µ–∂–∏–º–µ —Å 1 –≤–ª–∞–¥–µ–ª—å—Ü–µ–º.