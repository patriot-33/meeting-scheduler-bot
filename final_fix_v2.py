#!/usr/bin/env python3
"""Final fixes for remaining encoding issues."""

import re

# Fix src/handlers/common.py
print("Fixing src/handlers/common.py...")
with open('src/handlers/common.py', 'r', encoding='utf-8') as f:
    content = f.read()

# Common fixes
replacements = {
    '06<8B5 /register 4;O @538AB@0F88': '–ù–∞–∂–º–∏—Ç–µ /register –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏',
    '9 0H0 70O2:0 >68405B >4>1@5=8O 04<8=8AB@0B>@><': '‚è≥ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –æ–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º',
    'üìã 4<8=8AB@0B>@': 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
    'üìã A=>2=K5 :><0=4K': 'üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã',
    'üìã **;0=8@>20=85 2AB@5G:**': 'üìÖ **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á:**',
    '60 <8=CB': '60 –º–∏–Ω—É—Ç',
}

for old, new in replacements.items():
    content = content.replace(old, new)

with open('src/handlers/common.py', 'w', encoding='utf-8') as f:
    f.write(content)

# Fix src/handlers/manager.py
print("Fixing src/handlers/manager.py...")
with open('src/handlers/manager.py', 'r', encoding='utf-8') as f:
    content = f.read()

manager_replacements = {
    '<4 >B?CA:5': '–í –æ—Ç–ø—É—Å–∫–µ',
    '> 1>;L=8G=><': '–ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º',
    ' :><0=48@>2:5': '–í –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–µ',
    '=50:B82=>< AB0BCA5': '–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ',
    'ÔøΩ K =0E>48B5AL =0': '‚ùå –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Å—Ç–∞—Ç—É—Å–µ',
    ';O =07=0G5=8O 2AB@5G A=0G0;0 25@=8B5AL 2 0:B82=K9 AB0BCA:': '–î–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å:',
    '=  A>60;5=8N, =0 1;8609H85 4 =545;8 =5B A2>1>4=KE A;>B>2.': 'üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 4 –Ω–µ–¥–µ–ª–∏ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.',
    '>?@>1C9B5 ?>765 8;8 A2O68B5AL A 04<8=8AB@0B>@><.': '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.',
    '=ÔøΩ >ABC?=K5 A;>BK 4;O 2AB@5G': 'üìÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –≤—Å—Ç—Ä–µ—á',
    '= 0 4>ABC?=K5 4=8 =5B A2>1>4=KE A;>B>2.': '‚ùå –ù–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–Ω–∏ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.',
    'ÔøΩ @>87>H;0 >H81:0 ?@8 ?>;CG5=88 4>ABC?=KE A;>B>2. >?@>1C9B5 ?>765.': '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
    'ÔøΩ 5;L7O =07=0G8BL 2AB@5GC 2 =50:B82=>< AB0BCA5.': '‚ùå –ù–µ–ª—å–∑—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ.',
    'ÔøΩ # 20A C65 5ABL 70?;0=8@>20==0O 2AB@5G0.': '‚ùå –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞.',
    '!;54CNICN 2AB@5GC <>6=> =07=0G8BL =5 @0=55': '–°–ª–µ–¥—É—é—â—É—é –≤—Å—Ç—Ä–µ—á—É –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–µ —Ä–∞–Ω–µ–µ',
    'ÔøΩ  A>60;5=8N, MB>B A;>B C65 70=OB. >?@>1C9B5 2K1@0BL 4@C3>5 2@5<O.': '‚ùå –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —ç—Ç–æ—Ç —Å–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è.',
    '=ÔøΩ >20O 2AB@5G0': 'üìÖ –ù–æ–≤–∞—è –≤—Å—Ç—Ä–µ—á–∞',
    '=d': 'üë§',
    '<ÔøΩ': 'üè¢',
    '=ÔøΩ': 'üìÖ',
    ' AB@5G0 CA?5H=> =07=0G5=0!': '‚úÖ –í—Å—Ç—Ä–µ—á–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞!',
    'ÔøΩ @5<O:': 'üïê –í—Ä–µ–º—è:',
    '= K ?>;CG8B5 =0?><8=0=85 70 1 G0A 4> 2AB@5G8.': 'üí° –í—ã –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 —á–∞—Å –¥–æ –≤—Å—Ç—Ä–µ—á–∏.',
    'ÔøΩ @>87>H;0 >H81:0 ?@8 =07=0G5=88 2AB@5G8. >?@>1C9B5 ?>765.': '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –≤—Å—Ç—Ä–µ—á–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
    '>7B # 20A =5B 70?;0=8@>20==KE 2AB@5G.': 'üìÖ –£ –≤–∞—Å –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á.',
    '06<8B5 /schedule 4;O =07=0G5=8O =>2>9 2AB@5G8.': '–ù–∞–∂–º–∏—Ç–µ /schedule –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–æ–≤–æ–π –≤—Å—Ç—Ä–µ—á–∏.',
    '=ÔøΩ 0H8 70?;0=8@>20==K5 2AB@5G8:': 'üìÖ –í–∞—à–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏:',
    'L B<5=8BL': '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å',
    'ÔøΩ AB@5G0 =5 =0945=0.': '‚ùå –í—Å—Ç—Ä–µ—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.',
    'L AB@5G0 >B<5=5=0': '‚úÖ –í—Å—Ç—Ä–µ—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞',
    '>65B5 =07=0G8BL =>2CN 2AB@5GC G5@57 /schedule': '–ú–æ–∂–µ—Ç–µ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–æ–≤—É—é –≤—Å—Ç—Ä–µ—á—É —á–µ—Ä–µ–∑ /schedule',
    '<4 >B?CA:': '–í –æ—Ç–ø—É—Å–∫–µ',
    '> 1>;L=8G=K9': '–ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º',
    ' :><0=48@>2:0': '–í –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–µ',
    ' 0:B82=K9': '–ê–∫—Ç–∏–≤–Ω—ã–π',
    ' 0H AB0BCA 87<5=5= =0:': '‚úÖ –í–∞—à —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:',
    '=d **>9 ?@>D8;L**': 'üë§ **–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å**',
    '=ÔøΩ <O:': 'üë§ –ò–º—è:',
    '<ÔøΩ B45;:': 'üè¢ –û—Ç–¥–µ–ª:',
    '!B0BCA:': '–°—Ç–∞—Ç—É—Å:',
    '=ÔøΩ **!B0B8AB8:0:**': 'üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**',
    '" A53> 2AB@5G:': '‚Ä¢ –í—Å–µ–≥–æ –≤—Å—Ç—Ä–µ—á:',
    '" @>2545=>:': '‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ:',
    '" >A;54=OO 2AB@5G0:': '‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω—è—è –≤—Å—Ç—Ä–µ—á–∞:',
    ' 2 ': ' –≤ ',
    '"<4"': '"üèñÔ∏è"',
    '">"': '"üè•"',
    '""': '"‚úàÔ∏è"',
    '""': '"‚úÖ"',
    '"S"': '"‚ùì"',
}

for old, new in manager_replacements.items():
    content = content.replace(old, new)

with open('src/handlers/manager.py', 'w', encoding='utf-8') as f:
    f.write(content)

# Fix src/handlers/registration.py
print("Fixing src/handlers/registration.py...")
with open('src/handlers/registration.py', 'r', encoding='utf-8') as f:
    content = f.read()

reg_replacements = {
    '?5@0F88': '–û–ø–µ—Ä–∞—Ü–∏–∏',
    '9 0H0 70O2:0 =0 @538AB@0F8N C65 >B?@02;5=0 8 >68405B >4>1@5=8O 04<8=8AB@0B>@><.': '‚è≥ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –æ–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.',
    ' K C65 70@538AB@8@>20=K! A?>;L7C9B5 /help 4;O ?@>A<>B@0 4>ABC?=KE :><0=4.': '–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.',
    '=K >1@> ?>60;>20BL!': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
    '/ 1>B 4;O ?;0=8@>20=8O 2AB@5G A @C:>2>48B5;O<8 >B45;>2.': '–Ø –±–æ—Ç –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å—Ç—Ä–µ—á —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º–∏ –æ—Ç–¥–µ–ª–æ–≤.',
    ';O =0G0;0 40209B5 ?>7=0:><8<AO. 0: 0A 7>2CB? 2548B5 20H5 8<O:': '–î–ª—è –Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è. –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç? –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:',
    ' <O A;8H:>< :>@>B:>5. >60;C9AB0, 22548B5 ?>;=>5 8<O:': '–ò–º—è —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è:',
    ' $0<8;8O A;8H:>< :>@>B:0O. >60;C9AB0, 22548B5 ?>;=CN D0<8;8N:': '–§–∞–º–∏–ª–∏—è —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—É—é —Ñ–∞–º–∏–ª–∏—é:',
    '< K15@8B5 20H >B45;:': 'üè¢ –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –æ—Ç–¥–µ–ª:',
    ' !?0A81> 70 @538AB@0F8N!': '‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é!',
    '=Q 0H0 70O2:0 >B?@02;5=0 =0 >4>1@5=85 04<8=8AB@0B>@C.': '‚è≥ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.',
    'K ?>;CG8B5 C254><;5=85, :>340 20H0 70O2:0 1C45B >4>1@5=0.': '–í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –≤–∞—à–∞ –∑–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∞.',
    ' 4>1@8BL': '‚úÖ –û–¥–æ–±—Ä–∏—Ç—å',
    'L B:;>=8BL': '‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å',
    '< >20O 70O2:0 =0 @538AB@0F8N:': 'üìù –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:',
    '=  538AB@0F8O >B<5=5=0. A?>;L7C9B5 /start 4;O =0G0;0 70=>2>.': '‚ùå –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–Ω–æ–≤–æ.',
}

for old, new in reg_replacements.items():
    content = content.replace(old, new)

with open('src/handlers/registration.py', 'w', encoding='utf-8') as f:
    f.write(content)

# Fix src/services/reminder_service.py
print("Fixing src/services/reminder_service.py...")
with open('src/services/reminder_service.py', 'r', encoding='utf-8') as f:
    content = f.read()

reminder_replacements = {
    '=ÔøΩ @>A@>G5==K5 2AB@5G8': '‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏',
    '= 0?><8=0=85': 'üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ',
    '@>H;> 7 4=59 A ?>A;54=59 2AB@5G8.': '–ü—Ä–æ—à–ª–æ 7 –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—Å—Ç—Ä–µ—á–∏.',
    '>60;C9AB0, =07=0GLB5 A;54CNICN 2AB@5GC.': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∑–Ω–∞—á—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –≤—Å—Ç—Ä–µ—á—É.',
    '06<8B5 /schedule 4;O ?@>A<>B@0 4>ABC?=KE A;>B>2.': '–ù–∞–∂–º–∏—Ç–µ /schedule –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.',
    'ÔøΩ 06=>5 =0?><8=0=85': '‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ',
    'AB0;>AL 3 4=O 4> :@09=53> A@>:0 =07=0G5=8O 2AB@5G8.': '–û—Å—Ç–∞–ª–æ—Å—å 3 –¥–Ω—è –¥–æ –∫—Ä–∞–π–Ω–µ–≥–æ —Å—Ä–æ–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏.',
    '>60;C9AB0, >1O70B5;L=> =07=0GLB5 2AB@5GC!': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á—å—Ç–µ –≤—Å—Ç—Ä–µ—á—É!',
    '=4 @8B8G=>5 =0?><8=0=85': 'üö® –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ',
    'AB0;AO 1 45=L 4> :@09=53> A@>:0!': '–û—Å—Ç–∞–ª—Å—è 1 –¥–µ–Ω—å –¥–æ –∫—Ä–∞–π–Ω–µ–≥–æ —Å—Ä–æ–∫–∞!',
    'A;8 2K =5 =07=0G8B5 2AB@5GC, 04<8=8AB@0B>@K 1C4CB C254><;5=K.': '–ï—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞–∑–Ω–∞—á–∏—Ç–µ –≤—Å—Ç—Ä–µ—á—É, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –±—É–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω—ã.',
    '07=0G8BL 2AB@5GC !\'!': '–ù–∞–∑–Ω–∞—á–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É –°–ï–ô–ß–ê–°',
    '= 0?><8=0=85 > 2AB@5G5': 'üïê –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—Å—Ç—Ä–µ—á–µ',
    '\'5@57 1 G0A C 20A 2AB@5G0!': '–ß–µ—Ä–µ–∑ 1 —á–∞—Å —É –≤–∞—Å –≤—Å—Ç—Ä–µ—á–∞!',
    '>43>B>2LB5AL : A>72>=C!': '–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —Å–æ–∑–≤–æ–Ω—É!',
}

for old, new in reminder_replacements.items():
    content = content.replace(old, new)

with open('src/services/reminder_service.py', 'w', encoding='utf-8') as f:
    f.write(content)

print("\n‚úÖ All files fixed successfully!")

# Test syntax
print("\nTesting syntax...")
import subprocess
result = subprocess.run(['python3', 'test_imports.py'], capture_output=True, text=True)
print(result.stdout)
if result.returncode != 0:
    print(result.stderr)